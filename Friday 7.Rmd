---
title: "Cadaveric Study of the branches of the External Carotid Artery (ECA)"
author: "Ryan Barkham"
date: "2025-11-06"
output: html_document
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE)
```


First, lets load the packaged required to run this model
```{r}
library(tidyverse)
library(lme4)
library(lmtest)
library(car)
library(knitr)

```




# _Loading our data:_
Here we're loading our data, and wrangleing it so its ready for analysis.
```{r}

data <- read_csv("ECA_variant_dataset_with_types.csv")


#encode the varibales as factors, and rename
data$Sex = as.factor(data$sex)
data$Side = as.factor(data$side)
data$Type = as.factor(data$variant_type) 

```


Create a separate object, containing only variants, and removing the "no variant" option which optimizes use for linear model
```{r}
datas= data %>% 
  filter(variant_present == "yes") %>% 
  droplevels()

```

# _Diameter_
Create linear model for diameter
```{r}
lm_model_dia <- lm(diameter_mm 
               ~ Sex 
               * Side 
               + Type
               + Type:Sex
               + Side:Sex
               , data=datas)
#were considering not just the effects that Sex, Side and Type may have on diameter, but also how they may ineract with one another to jointly affect diameter
```

Lets test if our model meets our assumptions, to ensure its fit for purpose
```{r}

shapiro.test(residuals(lm_model_dia)) #Test normaility


bptest(lm_model_dia) #Test equal variance 


dwtest(lm_model_dia) #Test for independence

Anova(lm_model_dia, type = "III")

```

# _Distance_
Create model for distance
```{r}
lm_model_dis <- lm(distance_mm 
               ~ Sex 
               * Side 
               + Type
               + Type:Sex
               + Side:Sex
               , data=datas)
```

Lets test if it meets our assumptions, to ensure it's fit for purpose
```{r}
shapiro.test(residuals(lm_model_dis)) #Test normality


bptest(lm_model_dis) #Test equal variance 


dwtest(lm_model_dis) #Test for independence

Anova(lm_model_dis, type = "III")

```



### _(Optional) Understanding the impact of applying a randomising effect, for a mixed model_ 
The mixed model can be found below, notice the errors which arise when we add (1|cadaver_id)
```{r}
library(DHARMa)
lmer_model <- lmer(diameter_mm 
               ~ Sex
               * Side 
               + Type
               + Type:Sex
               + Side:Sex
               +(1|cadaver_id)
               , data=datas)
# Simulate residuals
sim_res <- simulateResiduals(fittedModel = lmer_model, n = 1000)

shapiro.test(residuals(lmer_model))

# Test for normality
testUniformity(sim_res)

# Test for equal varience
testDispersion(sim_res)

# Test for temporal/autocorrelation
testResiduals(sim_res)

summary(lmer_model)


```